var isCameraAllowed=!1;define(["jquery","core/ajax","core/notification"],function(e,t,i){function n(){e(".mod_quiz-next-nav").prop("disabled",!0),e(".submitbtns").html('<p class="text text-red red">You need to enable web camera before submitting this quiz!</p>')}e(function(){e("#id_submitbutton").prop("disabled",!0),e("#id_proctoring").on("change",function(){this.checked&&isCameraAllowed?e("#id_submitbutton").prop("disabled",!1):e("#id_submitbutton").prop("disabled",!0)})});var a=3e4;return{setup:function(o){if(a=o.camshotdelay,null!==document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length)return!1;if(null!==document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length)return!1;var d=o.image_width,r=0,s=!1,c=null;e("#mod_quiz_navblock").append('<div class="card-body p-3"><h3 class="no text-left">Webcam</h3> <br/><video id="video">Video stream not available.</video><canvas id="canvas" style="display:none;"></canvas><div class="output" style="display:none;"><img id="photo" alt="The picture will appear in this box."/></div></div>');var u=document.getElementById("video"),l=document.getElementById("canvas"),m=document.getElementById("photo"),g=function(){var e=l.getContext("2d");if(d&&r){l.width=d,l.height=r,e.drawImage(u,0,0,d,r),c=l.toDataURL("image/png"),m.setAttribute("src",c),o.webcampicture=c;var n={methodname:"quizaccess_proctoring_send_camshot",args:{courseid:o.courseid,screenshotid:o.id,quizid:o.quizid,webcampicture:c}};t.call([n])[0].done(function(e){e.warnings.length<1||u&&i.addNotification({message:"Something went wrong during taking the image.",type:"error"})}).fail(i.exception)}else!function(){var e=l.getContext("2d");e.fillStyle="#AAA",e.fillRect(0,0,l.width,l.height),c=l.toDataURL("image/png"),m.setAttribute("src",c)}()};return navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(e){u.srcObject=e,u.play(),isCameraAllowed=!0}).catch(function(){n()}),u?(u.addEventListener("canplay",function(){s||(r=u.videoHeight/(u.videoWidth/d),isNaN(r)&&(r=d/(4/3)),u.setAttribute("width",d),u.setAttribute("height",r),l.setAttribute("width",d),l.setAttribute("height",r),s=!0)},!1),u.addEventListener("click",function(e){g(),e.preventDefault()},!1),setTimeout(g,3e3),setInterval(g,a)):n(),!0},init:function(n){var a=320,o=0,d=!1,r=null,s=null,c=null,u=null;function l(){if(isCameraAllowed){var e=s.getContext("2d");e.fillStyle="#AAA",e.fillRect(0,0,s.width,s.height),u=s.toDataURL("image/png"),c.setAttribute("src",u)}else m()}function m(){e(".mod_quiz-next-nav").prop("disabled",!0),e(".submitbtns").html('<p class="text text-red red">You need to enable web camera before submitting this quiz!</p>')}return r=document.getElementById("video"),s=document.getElementById("canvas"),c=document.getElementById("photo"),r?(navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(e){r.srcObject=e,r.play(),isCameraAllowed=!0}).catch(function(){i.addNotification({message:"Please allow camera access in your browser.",type:"warning"}),m()}),r.addEventListener("canplay",function(){d||(o=r.videoHeight/(r.videoWidth/a),isNaN(o)&&(o=a/(4/3)),r.setAttribute("width",a),r.setAttribute("height",o),s.setAttribute("width",a),s.setAttribute("height",o),d=!0)},!1),r.addEventListener("click",function(e){!function(){var e=s.getContext("2d");if(a&&o){s.width=a,s.height=o,e.drawImage(r,0,0,a,o),u=s.toDataURL("image/png"),c.setAttribute("src",u);var d={courseid:n.courseid,screenshotid:n.id,quizid:n.quizid,webcampicture:u},m={methodname:"quizaccess_proctoring_send_camshot",args:d};t.call([m])[0].done(function(e){e.warnings.length<1||i.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}).fail(i.exception)}else l()}(),e.preventDefault()},!1)):m(),l(),u}}});
//# sourceMappingURL=proctoring.min.js.map
