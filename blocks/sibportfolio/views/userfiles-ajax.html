{% verbatim %}
<script id="block_sibportfolio_tmpl1" type="text/x-handlebars-template">
    {{# each files }}
    <table class='table block_sibportfolio_lightgray' cellpadding='5' style='border: 2px solid lightgray; margin-bottom: 10px;'>
        <tr>
            <td colspan='{{# if ../claims_block }}4{{ else }}3{{/ if }}'>{{ descr }}</td>
        </tr>
        <tr>
            <td style='width: 225px; vertical-align: middle;'>{{ ../date_label }}: <i>{{ date }}</i></td>
            <td style='width: 175px; vertical-align: middle;'>
                <i class="fa fa-1x fa-file-o "></i>
                <span class='block_sibportfolio_helptext' help-attribute='{{ filename }}' style='border: none;'>{{{ link }}}</span>
            </td>
            <td style='{{# if ../claims_block }}width: 150px;{{/ if }} vertical-align: middle;'>
                {{# if ../usecomments }}
                <i class="fa fa-1x fa-comments"></i>
                <a href='{{ ../showcomments_url }}'>{{ ../../comments_label }}: {{ ../commentscount }}</a>
                {{/ if }}
            </td>
            {{# if ../claims_block }}
            <td style='vertical-align: middle;'>
                <form action='{{ ../../wwwroot }}/blocks/sibportfolio/handlers/forms/delfile.php' method='get' style='float: right;'>
                    <input type='hidden' name='claimid' value='{{ ../claimid }}' />
                    <input type='hidden' name='returnurl' value='{{ ../../return_url }}' />
                    <input type='submit' class='block_sibportfolio_button' style='width: 130px; height: 25px; padding: 0; margin: 0; margin-right: 3px;' value='{{ ../../del_label }}'>
                </form>
                <form action='{{ ../../wwwroot }}/blocks/sibportfolio/handlers/forms/editfile.php' method='get' style='float: right;'>
                    <input type='hidden' name='claimid' value='{{ ../claimid }}' />
                    <input type='hidden' name='returnurl' value='{{ ../../return_url }}' />
                    <input type='submit' class='block_sibportfolio_button' style='width: 130px; height: 25px; padding: 0; margin: 0; margin-right: 3px;' value='{{ ../../edit_label }}'>
                </form>
            </td>
            {{/ if }}
        </tr>
    </table>
    {{/ each }}
</script>

<script id="block_sibportfolio_tmpl2" type="text/x-handlebars-template">
    {{# each pages }}
    {{# if url }}
        <form style='float: left;' action='{{ ../../wwwroot }}/blocks/sibportfolio/userfiles.php' method='get'>
            <input type='hidden' name='userid' value='{{ ../../user_id }}' />
            <input type='hidden' name='categoryid' value='{{ ../../category_id }}' />
            <input type='hidden' name='page' value='{{ caption }}' />
            <input class='block_sibportfolio_pagebtn block_sibportfolio_button' style='{{ style }}' type='submit' value='{{ caption }}'>
        </form>
    {{ else }}
        <button style='float: left;' type='submit' disabled>..</button>
    {{/ if }}
    {{/ each }}
</script>
{% endverbatim %}

<script type="text/javascript">
	var jQuerySibport = jQuery.noConflict(true);

    jQuerySibport(document).ready(function ($) {

        var click = function (e) {
            e.preventDefault();
            $(".block_sibportfolio_tablediv > table").remove();
			$("#block_sibportfolio_load").show();
            $.ajax({
                url: $(e.target).parent("form").attr("action"),
                timeout: 60000,
                data: $(e.target).parent("form").serialize(),
                type: "get",
                dataType: "json",
                success: function (data) {
                    $("#block_sibportfolio_tmpl1").template(data).appendTo(".block_sibportfolio_tablediv");
                    $("#block_sibportfolio_pages").empty();
                    $("#block_sibportfolio_tmpl2").template(data).appendTo("#block_sibportfolio_pages");
                    $(".block_sibportfolio_pagebtn").on('click', click);
                    $("#block_sibportfolio_addru").val(data.return_url);
                },
                error: function () {
                    $(".block_sibportfolio_tablediv")
						.text("{{ error_label }}")
						.css({
						    color: "red",
						    "text-align": "center",
							"font-size": "14pt",
							"font-weight": "bold"
						});
                },
                complete: function () {
                    $("#block_sibportfolio_load").hide();
                }
            });
        }	
	
        $(".block_sibportfolio_pagebtn").on('click', click);
		$("<div id='block_sibportfolio_load' class='notification_label'><img src='{{ wwwroot }}/blocks/sibportfolio/pix/loading.gif'>  {{ loading_label }}</div>")
			.appendTo(".block_sibportfolio_tablediv")
			.hide();
    });
</script>